<!DOCTYPE html>
<html lang="et">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta property="og:url" content="https://mnemosyne.ee/eesti-sojapogenikud-teises-maailmasojas/" />
    <meta property="og:title" content="·WWII·" />
    <title>·WWII·</title>
    <link href="https://cloud.typography.com/6935656/6118392/css/fonts.css" rel="stylesheet" type="text/css" />
    <link href="./assets/bootstrap.css" rel="stylesheet" />
    <link href="./style.css" rel="stylesheet" />
</head>

<body style="background-image: url('/assets/moero.png'); height: 480.486px;">
    <div class="col-12" id="search">
        <h3 class="mb-3">Otsing</h3>
        <form class="form" id="searchform" action="/" method="GET">
            <input class="col-8 col-md-6 col-xl-4" type="search" name="q" placeholder="sisesta nimi →" />
            <button class="col-4 col-md-3 col-xl-2">Otsi</button>
        </form>
        <p id="new-refugee-feedback" class="mt-3">Tagasiside puuduva isiku kohta</p>
        <p class="mt-2 mb-4" id="search-count"></p>
        <pre id="hidden" class="d-none"></pre>
        <div id="search-results"></div>
    </div>
    <div class="d-none" id="popup-background"></div>

    <!-- Tagasiside vorm -->
    <div class="p-3 d-none" id="popup-content">
        <div class="row">
            <h2 class="col-12" id="db-feedback-v2-title">Tagasiside %name% kohta</h2>
            <div class="col-12 col-md-10 offset-md-1" id="db-feedback-v2-text">
                <p>
                    Kui Teie poolt pakutud muudatus puudutab persooni põhiandmeid - nimi
                    või sünni- ning surmaaasta - saatke õigeid andmeid kinnitav dokument
                    aadressile memoriaal@mnemosyne.ee
                </p>
            </div>
            <form class="col-12 col-md-8 offset-md-2" id="db-feedback-v2" method="POST" name="db-feedback-v2">
                <input type="hidden" name="form-name" value="db-feedback-v2" />
                <input id="db-feedback-v2-id" type="hidden" name="id" />
                <input id="db-feedback-v2-persoon" type="hidden" name="persoon" />
                <input id="db-feedback-v2-url" type="hidden" name="url" />
                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="db-feedback-v2-name">Nimi</label>
                    <input id="db-feedback-v2-name" name="name" />
                    <label class="form-label col-12 px-0" for="db-feedback-v2-forename">Eesnimi</label>
                    <input id="db-feedback-v2-forename" name="forename" />
                    <label class="form-label col-12 px-0" for="db-feedback-v2-surname">Perenimi</label>
                    <input id="db-feedback-v2-surname" name="surname" />
                    <label class="form-label col-12 px-0" for="db-feedback-v2-birth">Sünd</label>
                    <input id="db-feedback-v2-birth" type="date" name="birth" />
                    <label class="form-label col-12 px-0" for="db-feedback-v2-death">Surm</label>
                    <input id="db-feedback-v2-death" type="date" name="death" />
                    <label class="form-label col-12 px-0" for="db-feedback-v2-mother-forename">Ema eesnimi</label>
                    <input id="db-feedback-v2-mother-forename" name="mother-forename" />
                    <label class="form-label col-12 px-0" for="db-feedback-v2-father-forename">Isa eesnimi</label>
                    <input id="db-feedback-v2-father-forename" name="father-forename" />
                </div>
                <input class="d-none" id="db-feedback-v2-fax" type="tel" name="fax" />
                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="db-feedback-v2-email">Kontakt e-post</label><input
                        class="col-12 px-0" id="db-feedback-v2-email" type="email" name="contact-email" />
                </div>
                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="db-feedback-v2-phone">Kontakt telefon</label><input
                        class="col-12 px-0" id="db-feedback-v2-phone" type="tel" name="contact-phone" />
                </div>
                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="db-feedback-v2-feedback">Tagasiside</label><textarea
                        class="col-12 px-1" id="db-feedback-v2-feedback" name="feedback" rows="5"></textarea>
                </div>
                <div class="form-group mt-5 text-right">
                    <button class="btn btn-secondary" id="db-feedback-v2-cancel">
                        Tühista</button><button class="btn btn-primary ml-3" id="db-feedback-v2-submit" type="submit">
                        Saada tagasiside
                    </button>
                </div>
            </form>
            <h2 class="col-12 d-none" id="db-feedback-v2-success">
                Täname tagasiside eest
            </h2>
        </div>
    </div>

    <!-- Uue põgeniku lisamise vorm -->
    <div class="p-3 d-none" id="popup-question">
        <div class="row">
            <h2 class="col-12" id="db-question-title">Tagasiside Teise maailmasõja ajal Eestist põgenenud isiku kohta</h2>
            <div class="col-12 col-md-10 offset-md-1" id="db-question-text">
                <p>
                    Palun kirjutage nii täpselt, kui teate. Kui ei tea kuupäeva täpsusega, kirjutage aasta. Kui ei tea küla või linna, kirjutage maakond. Kui mõnele küsimusele ei oska vastata, jätke see vahele.
                </p>
            </div>
            <form class="col-12 col-md-8 offset-md-2" id="new-refugee-feedback" method="POST" name="new-refugee-feedback" netlify-honeypot="fax" netlify>
                <input type="hidden" name="form-name" value="new-refugee-feedback" />

                <h3>Eestist põgenenud isik</h3>
                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="new-refugee-forename">Eesnimi</label>
                    <input class="col-12 px-0" id="new-refugee-forename" type="name" name="new-refugee-forename" />
                </div>
                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="new-refugee-surname">Perenimi</label>
                    <input class="col-12 px-0" id="new-refugee-surname" type="name" name="new-refugee-surname" />
                </div>
                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="new-refugee-birthdate">Sünniaeg</label>
                    <input class="col-12 px-0" id="new-refugee-birthdate" type="date" name="new-refugee-birthdate" />
                </div>
                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="new-refugee-birthplace">Sünnikoht</label>
                    <input class="col-12 px-0" id="new-refugee-birthplace" type="name" name="new-refugee-birthplace" />
                </div>
                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="new-refugee-deathdate">Surmaaeg</label>
                    <input class="col-12 px-0" id="new-refugee-deathdate" type="date" name="new-refugee-deathdate" />
                </div>
                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="new-refugee-deathplace">Surmakoht</label>
                    <input class="col-12 px-0" id="new-refugee-deathplace" type="name" name="new-refugee-deathplace" />
                </div>

                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="new-refugee-other">Info</label>
                    <ul>
                        <li>tegevusala Eestis</li>
                        <li>elukoht Eestis</li>
                        <li>koht Eestis, kust asus põgenemis teekonnale</li>
                        <li>millal lahkus Eestist</li>
                        <li>kuidas Eestist lahkus? (laevaga, rongiga?)</li>
                        <li>kuhu jõudis (riik, linn?)</li>
                        <li>kas jäi sellele maale püsivalt elama või liikus edasi? </li>
                        <li>kui asus uude riiki, siis kuhu?</li>
                    </ul>
                    <textarea class="col-12 px-1" id="new-refugee-other" name="other" rows="5" placeholder="- tegevusala Eestis
- elukoht Eestis
- koht Eestis, kust asus põgenemis teekonnale
- millal lahkus Eestist
- kuidas Eestist lahkus? (laevaga, rongiga?)
- kuhu jõudis (riik, linn?)
- kas jäi sellele maale püsivalt elama või liikus edasi? 
- kui asus uude riiki, siis kuhu?"></textarea>
                </div>
                <hr/>

                <h3>Info andja</h3>
                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="db-question-relation">Suhe põgenenud isikuga</label>
                    <textarea class="col-12 px-1" id="db-question-relation" name="relation" rows="5"></textarea>
                </div>
                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="db-question-name">Nimi</label>
                    <input class="col-12 px-0" id="db-question-name" type="name" name="contact-name" />
                </div>
                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="db-question-email">Kontakt e-post</label>
                    <input class="col-12 px-0" id="db-question-email" type="email" name="contact-email" />
                </div>
                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="db-question-phone">Kontakt telefon</label><input
                        class="col-12 px-0" id="db-question-phone" type="tel" name="contact-phone" />
                </div>
                <hr/>

                <h3>Muu info</h3>
                <div class="form-group mt-5">
                    <label class="form-label col-12 px-0" for="db-question-other-info">Muu info</label>
                    <textarea class="col-12 px-1" id="db-question-other-info" name="other-info" rows="5"></textarea>
                </div>
                <hr/>

                <div class="form-group mt-5 text-right">
                    <button class="btn btn-secondary" id="new-refugee-feedback-cancel">
                        Tühista</button><button class="btn btn-primary ml-3" id="new-refugee-feedback-submit" type="submit">
                        Saada tagasiside
                    </button>
                </div>
            </form>
            <h2 class="col-12 d-none" id="new-refugee-feedback-success">
                Täname tagasiside eest
            </h2>
        </div>
    </div>
    
    <script src="./assets/jquery-3.3.1.min.js"></script>
    <script src="./script.js"></script>
    <script src="./functions/search.js"></script>
    <script>
        $(function () {
            var qs = function (key) {
                key = key.replace(/[*+?^$.\[\]{}()|\\\/]/g, "\\$&")
                var match = location.search.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)"))
                return match && decodeURIComponent(match[1].replace(/\+/g, " "))
            }

            var query = qs('q')

            if (query) {
                $('input[name="q"]').val(query)

                var qData = {
                    query: {
                        bool: {
                            must: {
                                multi_match: {
                                    query: query,
                                    fields: ['id', 'perenimi', 'eesnimi', 'id', 'pereseosed.kirje', 'kirjed.kirje' ],
                                    operator: 'and',
                                    type: 'cross_fields',
                                },
                            },
                            filter: { term: { wwii: 1 } }
                        },
                    },
                    sort: { 'eesnimi.raw': 'asc', 'perenimi.raw': 'asc' },
                    _source: [
                        'isperson', 'kivi', 'emem', 'evo', 'wwii', 'evokirje',
                        'perenimi', 'eesnimi', 'isanimi', 'emanimi', 'perenimed', 'eesnimed',
                        'sünd', 'surm', 'id',
                        'kirjed.kirje', 'kirjed.kirjekood', 'kirjed.viide', 'kirjed.allikas', 'kirjed.allika_nimetus',
                        'pereseosed.persoon', 'pereseosed.kirje',
                        'pereseosed.kirjekood', 'pereseosed.allikas', 'pereseosed.raamatupere',
                        'tahvlikirje.kirjekood', 'tahvlikirje.kirje', 'tahvlikirje.tahvel', 'tahvlikirje.tulp', 'tahvlikirje.rida'
                    ],
                }
                console.log(JSON.stringify(qData))
                $.ajax("/.netlify/functions/search", {
                    data: JSON.stringify(qData),
                    contentType: "application/json",
                    type: "POST",
                    cache: false,
                    success: function (data) {
                        console.log(data.error || 'All green')
                        // console.log(JSON.stringify(data, 0, 2))
                        $('#search-count').html(data.hits.total.value + (data.hits.total.value === 1 ? ' vaste' : ' vastet'))

                        for (var i = 0; i < data.hits.hits.length; i++) {
                            var text = []
                            var p = data.hits.hits[i]._source
                            // console.log(p)
                            // $('#hidden').html(JSON.stringify(p, 0, 2))

                            text.push('<div id="' + p.id + '" class="search-result pt-2 pb-4">')
                            text.push('<div class="row">')

                            text.push('<h3 class="search-result-name col-12 mb-2 mb-1">' + (p.eesnimi ? p.eesnimi : '') + ' ' + p.perenimi + '</h3>')

                            text.push('<div class="col-5 col-sm-3">')
                            if (p.sünd) { text.push('<p class="mb-0">Sünd: ' + p.sünd + '</p>') }
                            if (p.surm) { text.push('<p class="mb-0">Surm: ' + p.surm + '</p>') }
                            if (p.isanimi) { text.push('<p class="mb-0">Isanimi: ' + p.isanimi + '</p>') }
                            if (p.emanimi) { text.push('<p class="mb-0">Emanimi: ' + p.emanimi + '</p>') }
                            text.push('<p class="mb-0"><a href="./?q=' + p.id + '"># ' + p.id + '</a></p>')
                            text.push('<p class="search-result-feedback mt-3" data-id="' + p.id + '" data-name="' + p.eesnimi + ' ' + p.perenimi + '">Tagasiside</p>')
                            text.push('</div>')

                            text.push('<div class="search-result-info col-7 col-sm-6">')
                            p.kirjed = p.kirjed || []
                            for (var ik = 0; ik < p.kirjed.length; ik++) {
                                let a1 = a2 = ''
                                if (p.kirjed[ik].viide) {
                                    a1 = '<a href="' + p.kirjed[ik].viide + '" target="_blank">'
                                    a2 = '</a>'
                                }
                                text.push('<p class="mt-2 mb-0"><strong>' + a1 + p.kirjed[ik].allikas + a2 + ':</strong></p>')
                                if (p.kirjed[ik].kirje) { text.push('<p class="mb-1">') }
                                if (p.kirjed[ik].kirje) { text.push(p.kirjed[ik].kirje) }
                                if (p.kirjed[ik].kirje) { text.push('</p>') }
                            }
                            if (p.pereseosed && p.pereseosed.length > 0) {
                                let pered = {}
                                for (var ip = 0; ip < p.pereseosed.length; ip++) {
                                    let pereseos = p.pereseosed[ip]
                                    //- console.log('PERESEOS:', pereseos)
                                    if(!pered.hasOwnProperty(pereseos.raamatupere)) {
                                        pered[pereseos.raamatupere] = []
                                    }
                                    pered[pereseos.raamatupere].push({
                                        kirjekood: pereseos.kirjekood,
                                        kirje: pereseos.kirje
                                    })
                                }
                                for (const [perekood, pere] of Object.entries(pered)) {
                                    //- console.log(perekood, pere)
                                    text.push('<hr class="my-3">')
                                    text.push('<p class="my-0"><strong>' + perekood + ' (perekond):</strong></p>')
                                    for (const pereliige of pere) {
                                        text.push('<p class="mb-1">- ')
                                        text.push(pereliige.kirjekood + ': ' + pereliige.kirje)
                                        text.push('</p>')
                                    }
                                }
                            }
                            text.push('</div>')

                            if (p.tahvlikirje) {
                                text.push('<div class="search-result-plaque col-12 col-sm-3">')
                                if (p.tahvlikirje.tahvel) {
                                    text.push('<p class="mb-0">Tahvel Maarjamäel:</p>')
                                    text.push('<p class="mb-2 plaque-info">' + p.tahvlikirje.tahvel + '</p>')
                                }
                                if (p.tahvlikirje.tulp) { text.push('<p class="mb-2">Tulp: ' + p.tahvlikirje.tulp + ' / Rida: ' + p.tahvlikirje.rida + '</p>') }
                                if (p.tahvlikirje.kirje) {
                                    text.push('<p class="mb-0">Nimi tahvlil: ' + p.tahvlikirje.kirje + '</p>')
                                }
                            }

                            if (p.evo === 1) {
                                text.push('<hr/><p class="mb-0">Nimi ohvitseride mälestusseinal: ' + p.evokirje + '</p>')
                            }
                            text.push('</div>')
                            text.push('</div>')
                            text.push('</div>')

                            $('#search-results').append(text.join(''))
                        }
                    },
                    error: function( error) {
                        console.log(error)
                    }
                })
            }

        })
    </script>
</body>

</html>